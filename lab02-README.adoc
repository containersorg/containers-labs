= Lab 2 - Microservices Architecture

== Splitting the Pharmacy Application into Microservices

To transition from the monolithic architecture of the pharmacy application to a microservices-oriented approach, we will segment functionalities into distinct Flask applications, each representing a separate service.

Each microservice will be responsible for a specific domain of the application, allowing for independent development, deployment, and scaling. The following services will be created:

. Inventory Management Service: This service is responsible for handling operations related to inventory. File: inventory_service.py
. Order Processing Service: This service oversees the order placement and tracking processes. File: order_service.py
. Customer Management Service: This service is dedicated to handling customer information and details. File: customer_service.py
. Billing Service: Responsible for managing billing and payment processes. File: billing_service.py

image::micro.png[400,400,align=center]

Inside the `microservices` directory, you will find four separate Python files, each containing the code for one of the services mentioned above.

== Understanding the Microservices Code

Each of these services should be stored in separate files and can be executed independently, as each application operates on its designated port.

[source,shell]
----
$ grep app.run *.py
inventory_service.py:    app.run(port=5001)
order_service.py:    app.run(port=5002)
customer_service.py:    app.run(port=5003)
billing_service.py:    app.run(port=5004)
----

To run each service independently, open four terminals, one for each service, and execute them as follows:

- On terminal one run: `python3 inventory_service.py`
- On terminal two run: `python3 order_service.py`
- On terminal three run: `python3 customer_service.py`
- On terminal four run: `python3 billing_service.py

These services can communicate with each other through HTTP requests (API calls).

== Testing the Microservices Application

Once all the `Flask` apps are operational, they can typically be accessed at `http://localhost:500?/` by default. (Note the `?` in the port, which will change based on the service being called.)

Attempt to verify the inventory running on port 5001:

[source,shell]
----
$ curl http://127.0.0.1:5001/view_inventory

{"inventory":{"medicine_A":{"price":10,"stock":100},"medicine_B":{"price":15,"stock":50}}}
----

If an attempt is made to use the `view_inventory` service on a different port, it will fail, as this service is exclusively running on port `5001`.

[source,shell]
----
$ curl http://127.0.0.1:5002/view_inventory

<!doctype html>
<html lang=en>
<title>404 Not Found</title>
<h1>Not Found</h1>
<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>
----

// TODO: Add the testing manual commands
