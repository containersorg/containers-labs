= Lab 7 -

But wait! Just as we did in the manual procedure, we created a single image to run all the containers. Why donâ€™t we do the same here?

.Containerfile
[source,dockerfile]
----
FROM fedora
RUN dnf install -yqq python3 pip
RUN pip install Flask
COPY *.py .
ENTRYPOINT ["python3"]
----

Notice we have changed our image slightly to copy all the source code files and change the `CMD` for an `ENTRYPOINT` that will allow us to use the `CMD` at runtime to selectively run a specific python script that will be *taken as an argument*, as follows:

First, we build the image:

[source,shell]
----
$ podman build -t pharmacy:v2 .
----

Notice that since we called the container file exactly `Containerfile`, there is no need to specify the file name at build time

Now we run the containers:

[source,shell]
----
$ podman run --rm --name inventory_service --network host -d localhost/pharmacy:v2 inventory_service.py
$ podman run --rm --name order_service --network host -d localhost/pharmacy:v2 order_service.py
$ podman run --rm --name customer_service --network host -d localhost/pharmacy:v2 customer_service.py
$ podman run --rm --name billing_service --network host -d localhost/pharmacy:v2 billing_service.py
----

Test a service to be sure is working

[source,shell]
----
$ curl http://0.0.0.0:5001/view_inventory
{"inventory":{"medicine_A":{"price":10,"stock":100},"medicine_B":{"price":15,"stock":50}}}
----
